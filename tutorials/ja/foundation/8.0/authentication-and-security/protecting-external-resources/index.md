---
layout: tutorial
title: MobileFirst Server を使用した外部リソースの認証
breadcrumb_title: 外部リソースの保護
relevantTo: [android,ios,windows,javascript]
weight: 12
show_children: true
---
<!-- NLS_CHARSET=UTF-8 -->
## 概説
{: #overview }
保護リソースは、{{site.data.keys.mf_server }} 上で実行することも (例えば、**アダプターなど**)、**外部サーバー**上で実行することもできます。{{site.data.keys.product }} に付属の検証モジュールを使用して、外部サーバー上のリソースを保護できます。

このチュートリアルでは、{{site.data.keys.product_adj }} **アクセス・トークン**を検証する**フィルター**を実装することにより、外部**リソース・サーバー**を保護する方法を学習します。  
そのような保護を実装する際は、すべてをカスタム・コードにすることも、フローの一部をカプセル化した {{site.data.keys.product }} ヘルパー・ライブラリーのいずれかを使用することもできます。

**前提条件:**  

* [{{site.data.keys.product_adj }} セキュリティー・フレームワーク](../)の知識が必要です。

## フロー
{: #flow }
![外部リソースの保護のダイアグラム](external_resources_flow.jpg)

{{site.data.keys.mf_server }} には、**イントロスペクション・エンドポイント**というコンポーネントがあります。このコンポーネントで、{{site.data.keys.product_adj }} **アクセス・トークン**に含まれるデータを検証したり、それらのデータを抽出したりできます。このイントロスペクション・エンドポイントは REST API 経由で使用できます。

1. アプリケーションが {{site.data.keys.product }} クライアント SDK を使用して、保護リソースに対するリソース要求呼び出し (または HTTP 要求) を行います。要求には、`Authorization` ヘッダー (**クライアント・アクセス・トークン**) が付いている場合もあれば、ない場合もあります。
2. イントロスペクション・エンドポイントと通信するために、リソース・サーバー上の**フィルター**は、それ自身のために別のトークンを取得する必要があります (**機密クライアント**のセクションを参照してください)。
3. リソース・サーバー上の**フィルター**は、ステップ 1 の**クライアント・アクセス・トークン**を抽出し、それを検証のためにイントロスペクション・エンドポイントに送信します。
4. {{site.data.keys.product_adj }} 許可サーバーがトークンを無効 (またはトークンが存在しない) と判断した場合、クライアントは、必要なスコープ用の新しいトークンを取得するためにリソース・サーバーによってリダイレクトされます。{{site.data.keys.product_adj }} クライアント SDK が使用される場合、この部分は内部で行われます。

## 機密クライアント
{: #confidential-client }
イントロスペクション・エンドポイントはスコープ `authorization.introspect` によって保護されている内部リソースであるため、リソース・サーバーは、そこにデータを送信するために別のトークンを取得する必要があります。許可ヘッダーを付けずにイントロスペクション・エンドポイントへの要求を試行すると、401 応答が返されます。

外部リソース・サーバーが `authorization.introspect` スコープ用のトークンを要求できるようにするには、{{site.data.keys.mf_console }} からそのサーバーを**機密クライアント**として登録する必要があります。  

> [機密クライアント](../confidential-clients/)のチュートリアルで詳細を参照してください。

{{site.data.keys.mf_console }} で、**「設定」→「機密クライアント」**の下に新規エントリーを追加します。**「クライアント ID」**と**「クライアント秘密鍵」**の値を選択します。**「許可されるスコープ」**に、必ず `authorization.introspect` を設定してください。

<img class="gifplayer" alt="機密クライアントの構成" src="confidential-client.png"/>

## 実装
{: #implementations }
このフローは、さまざまな REST API に直接 HTTP 要求を行うことにより、手動で実装できます (資料を参照してください)。  
{{site.data.keys.product }} は、提供される**トラスト・アソシエーション・インターセプター**を使用するか、または提供される **Java トークン・バリデーター**を使用するその他の任意の Java ベース・フィルターを使用して、**WebSphere** サーバー上でこれを実現するのを支援するためのライブラリーも提供しています。
